<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="Encoding trace scenarios" href="../scenarios/index.html" /><link rel="prev" title="Mutable top-level signatures" href="../mutable-toplevel-signatures/index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>An idiom for event depiction - Practical Alloy</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2a5adf;
  --color-brand-content: #2a5adf;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Practical Alloy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">Practical Alloy</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about-alloy/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about-book/index.html">About this book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../writer-notes.html">Writer notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../structural-modeling/index.html">Structural modeling</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../structural-topics/index.html">Structural quick reads</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Structural quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/subset-signatures/index.html">Subset signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/nary-relations/index.html">Higher-arity relations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/enumerations/index.html">Enumeration signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/commands/index.html">Commands in detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/themes/index.html">Visualization customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/evaluator/index.html">The instance evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/testing-instances/index.html">Encoding test instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/relational-logic/index.html">A relational logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/bestiary/index.html">Arrow multiplicity checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/ordering/index.html">The predefined <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">ordering</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/modules/index.html">Module system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/recursion/index.html">Handling recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/integers/index.html">Working with integers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/type-system/index.html">Type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/analysis/index.html">Structural analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../behavioral-modeling/index.html">Behavioral modeling</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Behavioral quick reads</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Behavioral quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../mutable-toplevel-signatures/index.html">Mutable top-level signatures</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">An idiom for event depiction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenarios/index.html">Encoding trace scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluator/index.html">The trace evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../temporal-logic/index.html">A temporal logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pointwise-effects/index.html">Pointwise effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fairness/index.html">Safety, Liveness and Fairness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sequences/index.html">Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../macros/index.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../meta/index.html">Meta-capabilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protocol-design/index.html">Protocol design</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="an-idiom-for-event-depiction">
<span id="event-depiction"></span><h1>An idiom for event depiction<a class="headerlink" href="#an-idiom-for-event-depiction" title="Link to this heading">#</a></h1>
<p>When validating the file sharing example model in the main chapter
<a class="reference internal" href="../../../behavioral-modeling/index.html#behavioral-modeling"><span class="std std-ref">Behavioral modeling</span></a>, the reader has probably realized that the Alloy visualizer
does not show the event (or events) occurring in a given transition. This is
because, as customary in Alloy, events were modeled as regular predicates
restricting two succeeding states, and Alloy has no way of knowing that those
particular predicates should be interpreted as events. In this section, building
on the chapter on <a class="reference internal" href="../../../structural-topics/topics/themes/index.html#theme-customization"><span class="std std-ref">Visualization customization</span></a> for structural modeling, we will devise an <em>idiom</em>
(a modeling pattern) that allows the depiction of events in the visualizer. As
an opportune side effect, it also facilitates the writing of certain classes of
formulas.</p>
<p>Let’s consider an instance returned when executing command <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">example</span></code>, whose transitions are shown below.</p>
<a class="reference internal image-reference" href="../../../../_images/instance19.png"><img alt="../../../../_images/instance19.png" class="align-center" src="../../../../_images/instance19.png" style="width: 450px;" /></a>
<a class="reference internal image-reference" href="../../../../_images/instance21.png"><img alt="../../../../_images/instance21.png" class="align-center" src="../../../../_images/instance21.png" style="width: 450px;" /></a>
<a class="reference internal image-reference" href="../../../../_images/instance31.png"><img alt="../../../../_images/instance31.png" class="align-center" src="../../../../_images/instance31.png" style="width: 450px;" /></a>
<a class="reference internal image-reference" href="../../../../_images/instance41.png"><img alt="../../../../_images/instance41.png" class="align-center" src="../../../../_images/instance41.png" style="width: 450px;" /></a>
<p>After a short examination, and based upon our knowledge of the specification, we
can determine that this trace uploads a file, shares it, deletes it, empties the trash and then stutters forever. However, in the general
case, for more complex specifications, the fact that events aren’t displayed
makes their interpretation tedious and error-prone.</p>
<section id="depicting-parameterless-events">
<h2>Depicting parameterless events<a class="headerlink" href="#depicting-parameterless-events" title="Link to this heading">#</a></h2>
<p id="index-0">The crux of the idiom presented here is to use <em>derived relations</em> to represent
the events happening in a given state. In particular, the value of these
relations is calculated for each particular state, so their value may change
over the trace. Yet, it may not seem immediately obvious how to use them since
derived relations define relations based on existing signatures, while we
haven’t got any such signature for events, only predicates. No problem! Let’s
introduce a signature (more precisely: an enumeration, since the required atoms
are known and we won’t need to add fields) representing event names. Observe how
we use the capitalised names of predicates (corresponding to events) as elements
of the enumeration, in order to enhance readability.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="kd">enum</span> <span class="nc">Event</span> <span class="o">{</span>
  <span class="c1">// event names</span>
  <span class="n">Empty</span><span class="p">,</span> <span class="n">Upload</span><span class="p">,</span> <span class="n">Delete</span><span class="p">,</span> <span class="n">Restore</span><span class="p">,</span> <span class="n">Share</span><span class="p">,</span> <span class="n">Download</span><span class="p">,</span> <span class="n">Stutter</span>
<span class="o">}</span>
</pre></div>
</div>
<p id="index-1">Also, in the theme customisation menu, change the shape and colour of events, for instance to a blue parallelogram. Then set <span class="guilabel">Hide unconnected nodes</span> to <span class="guilabel">On</span> for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Event</span></code> nodes, as we don’t want to see all event names at all states, but only those corresponding to events <em>occurring in a given state</em>.</p>
<p id="index-2">Now, let’s introduce a first derived relation. Let us start with the simplest case, the events that take no parameters, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">empty</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">stutter</span></code>.</p>
<div class="highlight-electrum notranslate" id="index-3"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">empty_happens</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Event</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Empty</span> <span class="o">|</span> <span class="n">empty</span> <span class="o">}</span>
<span class="o">}</span>

<span class="k">fun</span> <span class="nf">stutter_happens</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Event</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Stutter</span> <span class="o">|</span> <span class="n">stutter</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This definition may seem strange at first but this is indeed what we want. Sets by comprehension retrieve a set of atoms for which a certain formulas is true; if this formula is temporal, a different set may be returned in each state. So the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">empty_happens</span></code> derived relation yields, in every state, a subset of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Event</span></code> that will be populated (exactly by singleton <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Empty</span></code>) if the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">empty</span></code> predicate is true, and empty otherwise.</p>
<p>Let us observe the effect of adding this derived relation to the visualisation. First, open the theme customisation menu and set both <span class="guilabel">Hide unconnected nodes</span> and <span class="guilabel">Show as labels</span> to <span class="guilabel">Off</span> for
the subsets <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">$empty_happens</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">$stutter_happens</span></code>. This will override the hiding of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Event</span></code> nodes that belong to those subset.</p>
<a class="reference internal image-reference" href="../../../../_images/theme1.png"><img alt="../../../../_images/theme1.png" class="align-center" src="../../../../_images/theme1.png" style="width: 700px;" /></a>
<p>Then head to the last states of the trace (where the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">empty</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">stutter</span></code> events occur). You will now be able to observe the event happening, as shown below.</p>
<a class="reference internal image-reference" href="../../../../_images/instance51.png"><img alt="../../../../_images/instance51.png" class="align-center" src="../../../../_images/instance51.png" style="width: 550px;" /></a>
</section>
<section id="depicting-events-with-parameters">
<h2>Depicting events with parameters<a class="headerlink" href="#depicting-events-with-parameters" title="Link to this heading">#</a></h2>
<p>Now, let’s consider events that have parameters, such as the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code> event that takes a file as a parameter. In this case, the derived relation shouldn’t just yield the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Upload</span></code> name as we wouldn’t be able to tell for which file (or files) it is satisfied. We rather return the set of all pairs whose first coordinate is the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Upload</span></code> name and whose second coordinate is a file on which the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code> event happens. And likewise for the other
events that take a single parameter.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">upload_happens</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Upload</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="n">upload</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>

<span class="k">fun</span> <span class="nf">delete_happens</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Delete</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="n">delete</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>

<span class="k">fun</span> <span class="nf">restore_happens</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Restore</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="n">restore</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>

<span class="k">fun</span> <span class="nf">download_happens</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Share</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">download</span><span class="o">[</span><span class="n">t</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now the first state of the trace is as follows. Since <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Event</span></code> nodes
related by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload_happens</span></code> are no longer unconnected, they will show
up in the visualization without needing to change the theme as was the case for
the events without parameters.</p>
<a class="reference internal image-reference" href="../../../../_images/instance61.png"><img alt="../../../../_images/instance61.png" class="align-center" src="../../../../_images/instance61.png" style="width: 650px;" /></a>
<p>Finally, we can proceed with the last event, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">share</span></code>. Since this event takes two parameters, the derived relation representing it will now be ternary,
the first coordinate having the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Share</span></code> name and the other two the file and the token on which the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">share</span></code> event occurs.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">share_happens</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Share</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">share</span><span class="o">[</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The result is as follows.</p>
<a class="reference internal image-reference" href="../../../../_images/instance71.png"><img alt="../../../../_images/instance71.png" class="align-center" src="../../../../_images/instance71.png" style="width: 650px;" /></a>
<p>As you start visualising a trace, you may realise that the depiction of events without further theme customization is deficient when an event takes two parameters or more. A possible alternative visualization is to show event parameters as labels of the event name rather than edges. However, we need to
somehow identify which events occur in each state without relying on those edges and the <span class="guilabel">Hide unconnected nodes</span> option. To do so, we can introduce a further derived relation that just returns the set of names of events occurring in a state.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">events</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Event</span> <span class="o">{</span>
  <span class="n">empty_happens</span> <span class="o">+</span> <span class="n">stutter_happens</span> <span class="o">+</span>
  <span class="o">(</span><span class="n">upload_happens</span> <span class="o">+</span> <span class="n">delete_happens</span> <span class="o">+</span> <span class="n">restore_happens</span><span class="o">).</span><span class="n">File</span> <span class="o">+</span>
  <span class="n">download_happens</span><span class="o">.</span><span class="n">Token</span> <span class="o">+</span> <span class="n">share_happens</span><span class="o">.</span><span class="n">Token</span><span class="o">.</span><span class="n">File</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note that, for instance, expression <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload_happens</span><span class="o">.</span><span class="n">File</span></code> projects away any parameter of upload events and keeps only the event name.
Then the following theme can be configured:</p>
<ul class="simple">
<li><p>Uncheck <span class="guilabel">Hide unconnected nodes</span> for the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">$events</span></code> set and set <span class="guilabel">Show as labels</span> to <span class="guilabel">Off</span>.</p></li>
<li><p>In the <span class="guilabel">relations</span> part, set all derived relations for events to <span class="guilabel">Show as attribute</span> and change the displayed name for the derived relations to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">args</span></code> (shown below for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">$upload_happens</span></code>).</p></li>
</ul>
<a class="reference internal image-reference" href="../../../../_images/theme2.png"><img alt="../../../../_images/theme2.png" class="align-center" src="../../../../_images/theme2.png" style="width: 700px;" /></a>
<p>This way, we get the following depiction. Notice how the arguments of events can be seen clearly (namely <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File1</span></code> for the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code> event in state 0, and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File1</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Token1</span></code> for the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">share</span></code> event in state 1).</p>
<a class="reference internal image-reference" href="../../../../_images/instance81.png"><img alt="../../../../_images/instance81.png" class="align-center" src="../../../../_images/instance81.png" style="width: 700px;" /></a>
<p>On a last note, in our file sharing example all events are interleaved, meaning that exactly one event occurs in each state. This is not necessarily the case, and models that allow true concurrency may allow many events to
occur simultaneously, which hinders even further the identification of the
occurring events without a proper visualization. Luckily, the idiom we just presented will work exactly the same if multiple events occur in a state: the derived relations will just return additional tuples, which will be depicted as well.</p>
</section>
<section id="event-idiom-beyond-visualization">
<h2>Event idiom beyond visualization<a class="headerlink" href="#event-idiom-beyond-visualization" title="Link to this heading">#</a></h2>
<p>This is it for the idiom enabling a more informative depiction of traces!
At the beginning of this section, however, we also said that the idiom is useful to specify certain classes of formulas in a nice way. Let’s explore this aspect. First, the idiom allows to greatly simplify the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">transitions_or_stutter</span></code> fact.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fact</span> <span class="nf">transitions_or_stutter</span> <span class="o">{</span>
  <span class="c1">// The system either evolves according to the defined actions or stutters</span>
  <span class="ow">always</span> <span class="k">some</span> <span class="n">events</span>
<span class="o">}</span>
</pre></div>
</div>
<p>You may also check whether our system effectively encode interleaved events,
by testing if it is possible to witness the occurrence of two events in the same state, which happens to be the case.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">check</span> <span class="n">at_most_one_event</span> <span class="o">{</span>
  <span class="ow">always</span> <span class="k">lone</span> <span class="n">events</span>
<span class="o">}</span> <span class="k">for</span> <span class="mi">3</span>
</pre></div>
</div>
<p>However, if, for example, remove the guard from event <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code> this command yields the following counter-example, where an occurrence of an <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code> of a file that is already uploaded is indistinguishable from stuttering.</p>
<a class="reference internal image-reference" href="../../../../_images/instance91.png"><img alt="../../../../_images/instance91.png" class="align-center" src="../../../../_images/instance91.png" style="width: 700px;" /></a>
<p>Perhaps more interesting, notice that predicates and functions belong to different namespaces in Alloy, and they can always be disambiguated based on the syntactic context. For this reason, it is possible to give to the functions defined above the same name as the respective predicates!</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">empty</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Event</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Empty</span> <span class="o">|</span> <span class="n">empty</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">fun</span> <span class="nf">stutter</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Event</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Stutter</span> <span class="o">|</span> <span class="n">stutter</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">fun</span> <span class="nf">upload</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Upload</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="n">upload</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">fun</span> <span class="nf">delete</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Delete</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="n">delete</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">fun</span> <span class="nf">restore</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Restore</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="n">restore</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">fun</span> <span class="nf">download</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Share</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">download</span><span class="o">[</span><span class="n">t</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">fun</span> <span class="nf">share</span> <span class="p">:</span> <span class="n">Event</span> <span class="o">-&gt;</span> <span class="n">File</span> <span class="o">-&gt;</span> <span class="n">Token</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Share</span><span class="p">,</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">share</span><span class="o">[</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now suppose you want to see the example of a trace in which two <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">share</span></code> events happen in a row (for arbitrary arguments). Until now, you would have had to write this in a rather contrived way, for instance as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">run</span> <span class="n">two_shares_in_a_row</span> <span class="o">{</span>
  <span class="ow">eventually</span> <span class="o">(</span>
    <span class="o">(</span><span class="k">some</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">share</span><span class="o">[</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="o">])</span> <span class="ow">and</span>
    <span class="ow">after</span> <span class="o">(</span><span class="k">some</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">share</span><span class="o">[</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="o">])</span>
  <span class="o">)</span>
<span class="o">}</span> <span class="k">for</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Yet, the derived relations defined above are also useful to say that an event happens (for some parameters). Indeed, it is enough to say that the corresponding derived relation is non-empty!</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">run</span> <span class="n">two_shares_in_a_row</span> <span class="o">{</span>
  <span class="ow">eventually</span> <span class="o">(</span><span class="k">some</span> <span class="n">share</span> <span class="ow">and</span> <span class="ow">after</span> <span class="k">some</span> <span class="n">share</span><span class="o">)</span>
<span class="o">}</span> <span class="k">for</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Thus, giving the same name to a predicate (representing an event) and to the respective derived relations makes it easy to say that an event <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">e</span></code> happens: you just have to write <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">some</span> <span class="n">e</span></code>!</p>
<p>As a final remark, notice that this idiom doesn’t entail any performance penalty:</p>
<ul class="simple">
<li><p>If derived relations are only used for the depiction of events, they are only computed when visualising instances.</p></li>
<li><p>If they are also used in formulas, to say for instance that an event happens, they actually use less variables than the version where a predicate is passed arguments quantified existentially.</p></li>
</ul>
<p>Thus, the only price to pay is a small but systematic inflation, albeit admittedly tedious, of our models. In the future, an extension to Alloy may be proposed to automate this task.</p>
<div class="sd-sphinx-override sd-cards-carousel sd-card-cols-1 docutils">
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-link" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg> Further reading</p>
</div>
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Encoding trace scenarios</div>
<p class="sd-card-text">The event idiom is also helpful when we are trying to encode concrete execution scenarios.</p>
</div>
<a class="sd-stretched-link reference internal" href="../scenarios/index.html#scenarios"><span class="std std-ref"></span></a></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../scenarios/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Encoding trace scenarios</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../mutable-toplevel-signatures/index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Mutable top-level signatures</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2024, Alcino Cunha, Nuno Macedo, Julien Brunel, David Chemouil
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">An idiom for event depiction</a><ul>
<li><a class="reference internal" href="#depicting-parameterless-events">Depicting parameterless events</a></li>
<li><a class="reference internal" href="#depicting-events-with-parameters">Depicting events with parameters</a></li>
<li><a class="reference internal" href="#event-idiom-beyond-visualization">Event idiom beyond visualization</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=36754332"></script>
    </body>
</html>