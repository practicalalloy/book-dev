<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="An idiom for event depiction" href="../event-depiction/index.html" /><link rel="prev" title="↳ Quick reads" href="../../index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Mutable top-level signatures - Practical Alloy</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2a5adf;
  --color-brand-content: #2a5adf;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Practical Alloy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">Practical Alloy</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about-alloy/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about-book/index.html">About this book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../writer-notes.html">Writer notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../structural-modeling/index.html">Structural modeling</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../structural-topics/index.html">↳ Quick reads</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of ↳ Quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/subset-signatures/index.html">Subset signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/nary-relations/index.html">Higher-arity relations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/enumerations/index.html">Enumeration signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/commands/index.html">Commands in detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/themes/index.html">Visualization customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/evaluator/index.html">The instance evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/testing-instances/index.html">Encoding test instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/relational-logic/index.html">A relational logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/bestiary/index.html">Arrow multiplicity checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/ordering/index.html">The predefined <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">ordering</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/modules/index.html">Module system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/recursion/index.html">Handling recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/integers/index.html">Working with integers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/type-system/index.html">Type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/analysis/index.html">Structural analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../behavioral-modeling/index.html">Behavioral modeling</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">↳ Quick reads</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of ↳ Quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Mutable top-level signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event-depiction/index.html">An idiom for event depiction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenarios/index.html">Encoding trace scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluator/index.html">The trace evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../temporal-logic/index.html">A temporal logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pointwise-effects/index.html">Pointwise effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fairness/index.html">Safety, Liveness and Fairness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sequences/index.html">Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../macros/index.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../meta/index.html">Meta-capabilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protocol-design/index.html">Protocol design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app-design/index.html">App design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interaction-design/index.html">Interaction design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../system-design/index.html">Controller design</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="mutable-top-level-signatures">
<span id="mutable-toplevel-signatures"></span><h1>Mutable top-level signatures<a class="headerlink" href="#mutable-top-level-signatures" title="Link to this heading">#</a></h1>
<p>In the specification of our file sharing app we have modeled the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> files using a mutable subset of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>, the top-level signature that contains the universe of all possible files that can exist in a trace. In Alloy it is also possible to declare mutable top-level signatures. For example, to model the uploaded files we could have declared <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> itself as mutable instead of adding a new subset signature, the idea being that the value of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> itself in each state corresponds to the set of uploaded files. The signature declarations would look as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="kd">sig</span> <span class="nc">Token</span> <span class="o">{}</span>
<span class="k">var</span> <span class="kd">sig</span> <span class="nc">File</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">shared</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Token</span>
<span class="o">}</span>
<span class="k">var</span> <span class="kd">sig</span> <span class="nc">trashed</span> <span class="k">in</span> <span class="nc">File</span> <span class="o">{}</span>
</pre></div>
</div>
<dl class="simple">
<dt>There are some important points to note when top-level signatures are used:</dt><dd><ul class="simple">
<li><p>The scope of a mutable top-level signature is the maximum number of different atoms it can contain in the full trace, and not the maximum at each different state. For example, with the default scope of 3, we can have at most 3 different uploaded files in each trace. For example, if at some state <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> contains 3 uploaded files, no more different files can be uploaded (of course, we can delete a file a re-uploaded it again later).</p></li>
<li><p>In Alloy all top-level and extension signatures are disjoint. The same is true for mutable top-level and extension signatures: they are always disjoint, even at different points in time, meaning that an atom cannot move from one top-level signature to another one in a state transition. For example, if <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Token</span></code> was also mutable, an atom contained in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> at some state could never be part of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Token</span></code> in a different state.</p></li>
<li><p>When there are mutable top-level signatures both the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="kc">univ</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="kc">iden</span></code> relations are mutable as well, with the former containing, in each state, all atoms contained in all signatures at that state.</p></li>
</ul>
</dd>
</dl>
<p>Updating the rest of the specification to accommodate this change is not just a matter of replacing <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> with <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>. In most formulas that will be the case, but in some formulas the changes are more subtle. As an example of the former case, consider fact <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">init</span></code>, that specifies the valid initial states.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fact</span> <span class="nf">init</span> <span class="o">{</span>
  <span class="c1">// Initially there are no files uploaded nor shared</span>
  <span class="k">no</span> <span class="n">File</span>
  <span class="k">no</span> <span class="n">shared</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Although this is a correct specification, the second constraint is now redundant. If in the initial state there are no atoms in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> it will be impossible for relation <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">shared</span></code> to have any tuples, so we can can simplify it as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fact</span> <span class="nf">init</span> <span class="o">{</span>
  <span class="c1">// Initially there are no files uploaded nor shared</span>
  <span class="k">no</span> <span class="n">File</span>
<span class="o">}</span>
</pre></div>
</div>
<p>As another example where just replacing <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> gives us the intended specification, consider action predicate <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">empty</span></code>, that specifies the action of emptying the trash bin.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">pred</span> <span class="nf">empty</span> <span class="o">{</span>
  <span class="k">some</span> <span class="n">trashed</span>             <span class="c1">// guard</span>
  <span class="k">no</span> <span class="n">trashed</span><span class="o">&#39;</span>              <span class="c1">// effect on trashed</span>
  <span class="n">File</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">File</span> <span class="o">-</span> <span class="n">trashed</span>   <span class="c1">// effect on File</span>
  <span class="n">shared</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">shared</span>         <span class="c1">// no effect on shared</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Here, the effect on <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> was just replaced by the same effect on <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>.</p>
<p>However, specifying action predicate <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code> is a bit more tricky, and cannot be updated by simply replacing <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>. In particular, it no longer makes sense to parametrize it by the file that will be uploaded, since that file will not even exist before the action occurs. Instead, we can have a non-parametrized predicate whose effect is to upload any new file. To enforce that signature <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> will contain a new uploaded file in the post-state we could, for example, use constraint <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">one</span> <span class="n">File</span><span class="o">&#39;</span> <span class="o">-</span> <span class="n">File</span></code> or, alternatively, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">some</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span><span class="o">&#39;</span> <span class="o">|</span> <span class="n">File</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">File</span> <span class="o">+</span> <span class="n">f</span></code>. The latter version is more convenient if we need to refer to the newly created atom in later effects, but that is not the case of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code>. The new specification of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">upload</span></code> could thus be as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">pred</span> <span class="nf">upload</span> <span class="o">{</span>
  <span class="k">one</span> <span class="n">File</span><span class="o">&#39;</span> <span class="o">-</span> <span class="n">File</span>     <span class="c1">// effect on File</span>
  <span class="n">trashed</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">trashed</span>   <span class="c1">// no effect on trashed</span>
  <span class="n">shared</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">shared</span>     <span class="c1">// no effect on shared</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In this example, the remaining action predicates can all be updated by just replacing <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>, and the fact that specifies the valid transitions will look as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fact</span> <span class="nf">transitions_or_stutter</span> <span class="o">{</span>
  <span class="c1">// The system must only evolve according to the defined actions</span>
  <span class="ow">always</span> <span class="o">(</span>
    <span class="n">upload</span> <span class="ow">or</span>
    <span class="o">(</span><span class="k">some</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="n">delete</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">or</span> <span class="n">restore</span><span class="o">[</span><span class="n">f</span><span class="o">])</span> <span class="ow">or</span>
    <span class="o">(</span><span class="k">some</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">share</span><span class="o">[</span><span class="n">f</span><span class="p">,</span><span class="n">t</span><span class="o">])</span> <span class="ow">or</span>
    <span class="o">(</span><span class="k">some</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="n">download</span><span class="o">[</span><span class="n">t</span><span class="o">])</span> <span class="ow">or</span>
    <span class="n">empty</span> <span class="ow">or</span>
    <span class="n">stutter</span>
  <span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Concerning assertions, again it might not suffice to just replace <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>. In particular, special care is needed with quantifications over mutable signatures. For example, consider assertion <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">restore_undos_delete</span></code>.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nf">restore_undos_delete</span> <span class="o">{</span>
  <span class="k">all</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="ow">always</span> <span class="o">(</span>
    <span class="n">delete</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">and</span> <span class="ow">after</span> <span class="n">restore</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">implies</span>
    <span class="n">File</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">File</span> <span class="ow">and</span> <span class="n">trashed</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">trashed</span> <span class="ow">and</span> <span class="n">shared</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">shared</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="k">check</span> <span class="n">restore_undos_delete</span>
</pre></div>
</div>
<p>This assertion is now trivially true, because the quantification <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">all</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span></code> is outside any temporal operator, and thus only needs to hold in the initial state where <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code> is still empty because no files were yet uploaded, as enforced by fact <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">init</span></code>. To correctly specify the desired assertion we need to move the quantification inside the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="ow">always</span></code> temporal operator, as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nf">restore_undos_delete</span> <span class="o">{</span>
  <span class="ow">always</span> <span class="k">all</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="o">(</span>
    <span class="n">delete</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">and</span> <span class="ow">after</span> <span class="n">restore</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">implies</span>
    <span class="n">File</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">File</span> <span class="ow">and</span> <span class="n">trashed</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">trashed</span> <span class="ow">and</span> <span class="n">shared</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">shared</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="k">check</span> <span class="n">restore_undos_delete</span>
</pre></div>
</div>
<p>Now, at each state the quantified property must hold for all files that are currently uploaded at that state.</p>
<p>For similar reasons, the specification of assertion <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">one_download_per_token</span></code> that used the following function, that computes the set of files that were once downloaded with a given token, no longer makes sense, because the function will now only return the files that are also currently uploaded.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">downloaded</span> <span class="o">[</span><span class="n">t</span> <span class="p">:</span> <span class="n">Token</span><span class="o">]</span> <span class="p">:</span> <span class="k">set</span> <span class="n">File</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="ow">once</span> <span class="o">(</span><span class="n">download</span><span class="o">[</span><span class="n">t</span><span class="o">]</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">shared</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>For this assertion we can still use the first formulation from the main chapter <a class="reference internal" href="../../../behavioral-modeling/index.html#behavioral-modeling"><span class="std std-ref">Behavioral modeling</span></a>: that did not use this function.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nf">one_download_per_token</span> <span class="o">{</span>
  <span class="k">all</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span> <span class="o">|</span> <span class="ow">always</span> <span class="o">(</span>
    <span class="n">download</span><span class="o">[</span><span class="n">t</span><span class="o">]</span> <span class="ow">implies</span>
    <span class="ow">after</span> <span class="ow">always</span> <span class="ow">not</span> <span class="n">download</span><span class="o">[</span><span class="n">t</span><span class="o">]</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="k">check</span> <span class="n">one_download_per_token</span>
</pre></div>
</div>
<p>Here the quantification <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">all</span> <span class="n">t</span> <span class="p">:</span> <span class="n">Token</span></code> can still be outside <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="ow">always</span></code>, because <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Token</span></code> is immutable and thus already contains all possible tokens in the initial state. Of course, it could also be moved inside the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="ow">always</span></code> because its value is the same in ever state.</p>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../event-depiction/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">An idiom for event depiction</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../../index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">↳ Quick reads</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2024, Alcino Cunha, Nuno Macedo, Julien Brunel, David Chemouil
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=36754332"></script>
    </body>
</html>