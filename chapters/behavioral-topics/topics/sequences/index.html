<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="Macros" href="../macros/index.html" /><link rel="prev" title="Safety, Liveness and Fairness" href="../fairness/index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Sequences - Practical Alloy</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2a5adf;
  --color-brand-content: #2a5adf;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Practical Alloy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">Practical Alloy</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about-alloy/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about-book/index.html">About this book</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../structural-modeling/index.html">Structural modeling</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../structural-topics/index.html">Structural quick reads</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Structural quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/subset-signatures/index.html">Subset signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/nary-relations/index.html">Higher-arity relations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/enumerations/index.html">Enumeration signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/commands/index.html">Commands in detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/themes/index.html">Visualization customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/evaluator/index.html">The instance evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/testing-instances/index.html">Encoding test instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/relational-logic/index.html">A relational logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/bestiary/index.html">Arrow multiplicity checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/ordering/index.html">The predefined <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">ordering</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/modules/index.html">Module system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/recursion/index.html">Handling recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/integers/index.html">Working with integers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/type-system/index.html">Type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../structural-topics/topics/analysis/index.html">Structural analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../behavioral-modeling/index.html">Behavioral modeling</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Behavioral quick reads</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Behavioral quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../mutable-toplevel-signatures/index.html">Mutable top-level signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event-depiction/index.html">An idiom for event depiction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenarios/index.html">Encoding trace scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluator/index.html">The trace evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../temporal-logic/index.html">A temporal logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pointwise-effects/index.html">Pointwise effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fairness/index.html">Safety, Liveness and Fairness</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../macros/index.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../meta/index.html">Meta-capabilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protocol-design/index.html">Protocol design</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="sequences">
<h1>Sequences<a class="headerlink" href="#sequences" title="Link to this heading">#</a></h1>
<p>Suppose we wanted <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">restore</span></code> to recover from the trash bin the last file that was deleted, instead of a specific file selected by the user. To allow this, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> can no longer be modelled just by a subset of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>. At an abstract level <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> should now be a <em>stack</em> operating under the <em>last in first out</em> principle. We could model such a <em>stack</em> in many different ways in Alloy, for example by using a binary relation that, given a file in the trash bin, gives us the next oldest file. Fortunately, Alloy has native support for sequences, so we can also use one of those to model the trash. Sequences can only be used in fields, meaning they must be used as attributes. To declare an attribute that is a sequence the keyword <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span></code> must be used, followed by the signature whose atoms can be contained in it. In our example, we want <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> to be of type <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span> <span class="n">File</span></code>, the sequence of files in the trash bin, sorted from oldest to newest. Since <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> must be an attribute of some signature, we will declare a singleton signature <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Trash</span></code> whose only purposed is to contain <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code>. Off course, we want <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> to still be mutable, so our declarations will look as follows.</p>
<div class="highlight-electrum notranslate" id="index-0"><div class="highlight"><pre><span></span><span class="kd">sig</span> <span class="nc">Token</span> <span class="o">{}</span>
<span class="kd">sig</span> <span class="nc">File</span> <span class="o">{</span>
   <span class="k">var</span> <span class="n">shared</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Token</span>
<span class="o">}</span>
<span class="k">var</span> <span class="kd">sig</span> <span class="nc">uploaded</span> <span class="k">in</span> <span class="nc">File</span> <span class="o">{}</span>
<span class="k">one</span> <span class="kd">sig</span> <span class="nc">Trash</span> <span class="o">{</span>
   <span class="k">var</span> <span class="n">trashed</span> <span class="p">:</span> <span class="k">seq</span> <span class="n">uploaded</span>
<span class="o">}</span>
</pre></div>
</div>
<dl class="simple">
<dt>When sequences are declared in a model, the standard module <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">util</span><span class="o">/</span><span class="n">sequniv</span></code> is automatically imported. This module contains many useful functions and predicates to work with sequences, namely:</dt><dd><ul class="simple">
<li><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">elems</span></code>, a function that given a sequence returns the set of elements contained in it.</p></li>
<li><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">isEmpty</span></code>, a predicate that checks if a sequence is empty.</p></li>
<li><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">first</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">last</span></code>, functions that given a sequence return its first and last element, respectively (or <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="kc">none</span></code> if the sequence is empty).</p></li>
<li><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">rest</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">butlast</span></code>, functions that given a sequence return a new sequence without its first or last elements, respectively.</p></li>
<li><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">add</span></code>, a function that given a sequence and an element, returns a new sequence with that element appended at the end.</p></li>
<li><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">insert</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">delete</span></code>, functions that allow insertion or deletion of elements at specific positions in a sequence.</p></li>
<li><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">hasDups</span></code>, a predicate that checks if a sequence has duplicates.</p></li>
</ul>
</dd>
</dl>
<p>In this module we can also see that a <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span> <span class="n">A</span></code> is implemented using a binary relation of type <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span><span class="o">/</span><span class="kt">Int</span> <span class="o">-&gt;</span> <span class="n">A</span></code>, where <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span><span class="o">/</span><span class="kt">Int</span></code> is a subset of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="kt">Int</span></code> containing only a prefix of the non-negative integers (starting at 0). All sequences are guaranteed to range over a prefix of the non-negative integers, for example sequence <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="o">]</span></code> is implemented by binary relation <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">{(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="mi">2</span><span class="p">,</span><span class="n">z</span><span class="o">)}</span></code>, and if we apply <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">rest</span></code> to this sequence we obtain <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">{(</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="mi">1</span><span class="p">,</span><span class="n">z</span><span class="o">)}</span></code>. This means that we can also use the standard relational operators with sequences, for example to check if a sequence <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">S</span></code> is empty we could use <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">no</span> <span class="n">S</span></code>, and to obtain the set of its elements we could use <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span><span class="o">/</span><span class="kt">Int</span><span class="o">.</span><span class="n">S</span></code>. However, here we will mainly use the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">util</span><span class="o">/</span><span class="n">sequniv</span></code> functions to manipulate sequences.</p>
<p>It is also important to know that we can control the size of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span><span class="o">/</span><span class="kt">Int</span></code> by setting a scope for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span></code>. The default scope for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span></code> is 4, meaning that sequences can have at most 4 elements. In this case, if a sequence already contains 4 elements and we try to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">add</span></code> another element, the same sequence will be returned, so we should be careful about setting a scope for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span></code> that is enough for our application (or specify the desired behavior when a sequence is full). In our example, it suffices that the scope of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span></code> is at least as big as the scope of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code>, because the same file cannot deleted again when it is already in the trash bin. We should also be aware that, since <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span><span class="o">/</span><span class="kt">Int</span></code> is a subset of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="kt">Int</span></code>, the scope of the later must be big enough to accommodate the former. For example, if we run the command <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">run</span> <span class="o">{}</span> <span class="k">for</span> <span class="mi">3</span> <span class="k">but</span> <span class="mi">5</span> <span class="k">seq</span><span class="p">,</span> <span class="mi">3</span> <span class="kt">Int</span></code> we will get an error stating that the scope of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="kt">Int</span></code> is not big enough to accommodate the desired scope for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">seq</span></code>, because with 3 bits we can only represent integers from -4 to 3, which is not enough to compute the maximum size of sequences, which in this case would be 5.</p>
<p>Most action predicates in our model must be changed to reflect the change in the declaration of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code>. For example, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">empty</span></code> was previously specified as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">pred</span> <span class="nf">empty</span> <span class="o">{</span>
   <span class="k">some</span> <span class="n">trashed</span>                     <span class="c1">// guard</span>
   <span class="k">no</span> <span class="n">trashed</span><span class="o">&#39;</span>                      <span class="c1">// effect on trashed</span>
   <span class="n">uploaded</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">uploaded</span> <span class="o">-</span> <span class="n">trashed</span>   <span class="c1">// effect on uploaded</span>
   <span class="n">shared</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">shared</span>                 <span class="c1">// no effect on shared</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Since now <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> is in fact a ternary relation of type <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Trash</span> <span class="o">-&gt;</span> <span class="k">seq</span><span class="o">/</span><span class="kt">Int</span> <span class="o">-&gt;</span> <span class="n">File</span></code>, the guard and effect condition on <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> using cardinality checks would still work, but we will instead use the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">util</span><span class="o">/</span><span class="n">sequniv</span></code> function <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">isEmpty</span></code> applied to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span></code>. However, the effect on <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">uploaded</span></code> would not work, and would raise a type error due to incompatible types. To determine the set of elements in the trash bin we should now use <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">elems</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span></code>. The updated specification of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">empty</span></code> would be as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">pred</span> <span class="nf">empty</span> <span class="o">{</span>
   <span class="ow">not</span> <span class="n">isEmpty</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span>                    <span class="c1">// guard</span>
   <span class="n">isEmpty</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">&#39;]</span>                       <span class="c1">// effect on trashed</span>
   <span class="n">uploaded</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">uploaded</span> <span class="o">-</span> <span class="n">elems</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span>   <span class="c1">// effect on uploaded</span>
   <span class="n">shared</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">shared</span>                              <span class="c1">// no effect on shared</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The most relevant changes are, of course, in the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">delete</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">restore</span></code> action predicates. The former should add the deleted file to the end of the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> sequence, and the latter no longer is parametrized by the file to be restored and should instead recover the last file of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code>.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">pred</span> <span class="nf">delete</span> <span class="o">[</span><span class="n">f</span> <span class="p">:</span> <span class="n">File</span><span class="o">]</span> <span class="o">{</span>
   <span class="n">f</span> <span class="ow">in</span> <span class="n">uploaded</span> <span class="o">-</span> <span class="n">elems</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span>    <span class="c1">// guard</span>
   <span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">add</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="p">,</span><span class="n">f</span><span class="o">]</span>   <span class="c1">// effect on trashed</span>
   <span class="n">shared</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">shared</span> <span class="o">-</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">Token</span>             <span class="c1">// effect on shared</span>
   <span class="n">uploaded</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">uploaded</span>                    <span class="c1">// no effect on uploaded</span>
<span class="o">}</span>

<span class="k">pred</span> <span class="nf">restore</span> <span class="o">{</span>
   <span class="ow">not</span> <span class="n">isEmpty</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span>                <span class="c1">// guard</span>
   <span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">butlast</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span>   <span class="c1">// effect on trashed</span>
   <span class="n">uploaded</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">uploaded</span>                      <span class="c1">// no effect on uploaded</span>
   <span class="n">shared</span><span class="o">&#39;</span> <span class="o">=</span> <span class="n">shared</span>                          <span class="c1">// no effect on shared</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Se see how sequences are visualized by the Analyzer, consider the following instance where two files are uploaded and then deleted in sequence. Only the transition corresponding to the last deletion is depicted. Note how the last deleted file is added to the end of the sequence, at index 1.</p>
<img alt="../../../../_images/instance.png" class="align-center" src="../../../../_images/instance.png" />
<p>The change of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> to a sequence has no significant impact in the specification of the assertions we checked in the original version, and only some minor and trivial changes are required. For example, to check that all shared files are not in the trash we should use the following assertion, where we just replaced <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">elems</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span></code>.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nf">shared_are_accessible</span> <span class="o">{</span>
   <span class="ow">always</span> <span class="n">shared</span><span class="o">.</span><span class="n">Token</span> <span class="ow">in</span> <span class="n">uploaded</span> <span class="o">-</span> <span class="n">elems</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To see an example where the change might not be so trivial, consider the valid assertion that delete undoes restore, which in the original model could have been specified as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nf">delete_undos_restore</span> <span class="o">{</span>
   <span class="k">all</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="ow">always</span> <span class="o">(</span>
      <span class="n">restore</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">and</span> <span class="ow">after</span> <span class="n">delete</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">implies</span>
      <span class="n">uploaded</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">uploaded</span> <span class="ow">and</span> <span class="n">trashed</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">trashed</span> <span class="ow">and</span> <span class="n">shared</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">shared</span>
   <span class="o">)</span>
<span class="o">}</span>
<span class="k">check</span> <span class="n">delete_undos_restore</span>
</pre></div>
</div>
<p>Since now <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">restore</span></code> has no parameters, we need to identify the file being restored by explicitly checking that it is the last of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code>, as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nf">delete_undos_restore</span> <span class="o">{</span>
   <span class="k">all</span> <span class="n">f</span> <span class="p">:</span> <span class="n">File</span> <span class="o">|</span> <span class="ow">always</span> <span class="o">(</span>
      <span class="n">f</span> <span class="o">=</span> <span class="n">last</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">sequence</span><span class="o">]</span> <span class="ow">and</span> <span class="n">restore</span> <span class="ow">and</span> <span class="ow">after</span> <span class="n">delete</span><span class="o">[</span><span class="n">f</span><span class="o">]</span> <span class="ow">implies</span>
      <span class="n">uploaded</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">uploaded</span> <span class="ow">and</span> <span class="n">trashed</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">trashed</span> <span class="ow">and</span> <span class="n">shared</span><span class="o">&#39;&#39;</span> <span class="o">=</span> <span class="n">shared</span>
   <span class="o">)</span>
<span class="o">}</span>
<span class="k">check</span> <span class="n">delete_undos_restore</span>
</pre></div>
</div>
<p>In this version with sequences we can also add a new invariant that checks that indeed the trash bin never contains duplicate files (which was trivial true in the original model, since <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">trashed</span></code> was a set).</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="nf">no_duplicates_in_trash</span> <span class="o">{</span>
   <span class="ow">always</span> <span class="ow">not</span> <span class="n">hasDups</span><span class="o">[</span><span class="n">Trash</span><span class="o">.</span><span class="n">trashed</span><span class="o">]</span>
<span class="o">}</span>
<span class="k">check</span> <span class="n">no_duplicates_in_trash</span>
</pre></div>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../macros/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Macros</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../fairness/index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Safety, Liveness and Fairness</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2024, Alcino Cunha, Nuno Macedo, Julien Brunel, David Chemouil
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=36754332"></script>
    </body>
</html>