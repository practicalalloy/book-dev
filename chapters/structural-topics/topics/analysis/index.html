<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="Behavioral modeling" href="../../../behavioral-modeling/index.html" /><link rel="prev" title="Type system" href="../type-system/index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Structural analysis - Practical Alloy</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2a5adf;
  --color-brand-content: #2a5adf;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Practical Alloy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">Practical Alloy</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about-alloy/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about-book/index.html">About this book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../writer-notes.html">Writer notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../structural-modeling/index.html">Structural modeling</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Structural quick reads</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Structural quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../subset-signatures/index.html">Subset signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nary-relations/index.html">Higher-arity relations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enumerations/index.html">Enumeration signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Commands in detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes/index.html">Visualization customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluator/index.html">The instance evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-instances/index.html">Encoding test instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relational-logic/index.html">A relational logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bestiary/index.html">Arrow multiplicity checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ordering/index.html">The predefined <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">ordering</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html">Module system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../recursion/index.html">Handling recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integers/index.html">Working with integers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../type-system/index.html">Type system</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Structural analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../behavioral-modeling/index.html">Behavioral modeling</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../behavioral-topics/index.html">Behavioral quick reads</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Behavioral quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/mutable-toplevel-signatures/index.html">Mutable top-level signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/event-depiction/index.html">An idiom for event depiction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/scenarios/index.html">Encoding trace scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/evaluator/index.html">The trace evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/temporal-logic/index.html">A temporal logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/pointwise-effects/index.html">Pointwise effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/fairness/index.html">Safety, Liveness and Fairness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/sequences/index.html">Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/macros/index.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/meta/index.html">Meta-capabilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protocol-design/index.html">Protocol design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app-design/index.html">App design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interaction-design/index.html">Interaction design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../system-design/index.html">Controller design</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="structural-analysis">
<span id="analysis"></span><h1>Structural analysis<a class="headerlink" href="#structural-analysis" title="Link to this heading">#</a></h1>
<p id="index-0">The Alloy Analyzer relies on a procedure called <em>model finding</em> to execute the
analysis commands. This procedure, in turn, relies on off-the-shelf solvers for
Boolean satisfiability problems (SAT). This chapter provides an overview of this
process, pointing out to other references for more detailed presentations.</p>
<section id="relational-model-finding">
<h2>Relational model finding<a class="headerlink" href="#relational-model-finding" title="Link to this heading">#</a></h2>
<p id="index-1">The Analyzer relies on an intermediate tool to perform relational model finding
named Kodkod <a class="reference internal" href="../../../../bibliography.html#fse04" id="id1"><span>[FSE04]</span></a>. Kodkod is also based on first-order relational logic, but
is stripped of all the structure and syntactic sugar supported by the Alloy
language: a Kodkod problem is simply a set of relations bounded by tuple sets
and a single formula that will be tested for satifiability. If a Kodkod problem
is satisfiable, an instance is returned that assigns a tuple set to each
declared relation. The problem’s relations are derived from the signatures and
fields declared in the Alloy model, and their bounds from the scope of the
command under analysis. The problem’s formula contains the model facts and
constraints defined in the command, as well as additional restrictions to encode
the signature hierarchy and multiplicity constraints. For <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">check</span></code>
commands, the expected property is negated so that Kodkod will search for
counter-examples, i.e., instances that obey all the model’s constraints but
break the expected property. Kodkod is also responsible for performing
Skolemization (see below), and detecting and enforcing symmetry breaking.</p>
<p>Let us get back to our file system example from the main chapter
<a class="reference internal" href="../../../structural-modeling/index.html#structural-modeling"><span class="std std-ref">Structural modeling</span></a>, a consider the following simple command with a small
scope, for instances where all entries point to directories.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">run</span> <span class="n">all_entries_dir</span> <span class="o">{</span>
  <span class="n">Entry</span><span class="o">.</span><span class="n">object</span> <span class="ow">in</span> <span class="n">Dir</span>
<span class="o">}</span> <span class="k">for</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Given this scope, a universe with 6 atoms is created, with 2 atoms for each
top-level signature. Then the following relations are declared with lower- and
upper-bounds.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="n">Root</span>    <span class="o">=</span> <span class="o">{(</span><span class="n">Root0</span><span class="o">)}</span> <span class="o">{(</span><span class="n">Root0</span><span class="o">)}</span>
<span class="n">Dir$</span>    <span class="o">=</span> <span class="o">{}</span>        <span class="o">{(</span><span class="n">Object0</span><span class="o">)}</span>
<span class="n">File</span>    <span class="o">=</span> <span class="o">{}</span>        <span class="o">{(</span><span class="n">Object0</span><span class="o">)}</span>
<span class="n">Entry</span>   <span class="o">=</span> <span class="o">{}</span>        <span class="o">{(</span><span class="n">Entry0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Entry1</span><span class="o">)}</span>
<span class="n">Name</span>    <span class="o">=</span> <span class="o">{}</span>        <span class="o">{(</span><span class="n">Name0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Name1</span><span class="o">)}</span>

<span class="n">entries</span> <span class="o">=</span> <span class="o">{}</span>        <span class="o">{(</span><span class="n">Root0</span><span class="p">,</span><span class="n">Entry0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Root0</span><span class="p">,</span><span class="n">Entry1</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Object0</span><span class="p">,</span><span class="n">Entry0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Object0</span><span class="p">,</span><span class="n">Entry1</span><span class="o">)}</span>
<span class="n">object</span>  <span class="o">=</span> <span class="o">{}</span>        <span class="o">{(</span><span class="n">Entry0</span><span class="p">,</span><span class="n">Root0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Entry1</span><span class="p">,</span><span class="n">Root0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Entry0</span><span class="p">,</span><span class="n">Object0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Entry1</span><span class="p">,</span><span class="n">Object0</span><span class="o">)}</span>
<span class="n">name</span>    <span class="o">=</span> <span class="o">{}</span>        <span class="o">{(</span><span class="n">Entry0</span><span class="p">,</span><span class="n">Name0</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Entry1</span><span class="p">,</span><span class="n">Name1</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Entry0</span><span class="p">,</span><span class="n">Name1</span><span class="o">)</span><span class="p">,</span><span class="o">(</span><span class="n">Entry0</span><span class="p">,</span><span class="n">Name1</span><span class="o">)}</span>
</pre></div>
</div>
<p>Note that there isn’t a relation created for signatures that are extended by
others. Instead, whenever called, they are replaced by the union of all its
children signatures. If the signature is not abstract, then a new relation is
declared to encode the atoms that do not belong to any of its children (we
denote this set with a <code class="code docutils literal notranslate"><span class="pre">$</span></code> suffix). For instance, any call to
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span></code> in an expression is replaced by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span> <span class="o">+</span> <span class="n">Dir$</span></code> in Kodkod, and
calls to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object</span></code> by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span> <span class="o">+</span> <span class="n">Root</span> <span class="o">+</span> <span class="n">Dir$</span></code> (since <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object</span></code>
is abstract, there are no objects that are not files or directories). Note also
that, since <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span></code> has multiplicity <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">one</span></code>, its lower-bound is the
same as its upper-bound, making it bound exactly; all other relations in this
model have an empty lower-bound.</p>
<p>Then, besides the constraints imposed by the model’s facts and the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">run</span></code>
command, a few other constraints are introduced from the signature declarations.
The first, shown below, forces the set of directories and files to be disjoint.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">no</span> <span class="o">(</span><span class="n">Root</span> <span class="o">+</span> <span class="n">Dir$</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">File</span>
</pre></div>
</div>
<p>The others enforce the type and multiplicity of the binary relations. Below are
the constraints corresponding to the <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">object</span></code> relation. The first
constraint enforces the multiplicity <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">one</span></code> for all entries and the
appropriate range type, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object</span></code>. The second constraint enforces the type
of the domain, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code>. These constraints may seem a bit spurious when
looking at the upper-bound of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">object</span></code>, since it only contains pairs
relating entries and objects. However, recall that at this point it is still
unknown which atoms will effectively exist in the instance. For instance,
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> can even be empty, and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">object</span></code> must be restricted
accordingly during solving.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">all</span> <span class="n">e</span> <span class="p">:</span> <span class="n">Entry</span> <span class="o">|</span> <span class="k">one</span> <span class="n">e</span><span class="o">.</span><span class="n">object</span> <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">object</span> <span class="ow">in</span> <span class="n">Root</span> <span class="o">+</span> <span class="n">Dir$</span> <span class="o">+</span> <span class="n">File</span>
<span class="n">object</span><span class="o">.</span><span class="kc">univ</span> <span class="ow">in</span> <span class="n">Entry</span>
</pre></div>
</div>
<p>You can actually inspect the generated Kodkod problem by setting menu option
<span class="menuselection">Options ‣ Record the Kodkod input/output</span> to
<span class="menuselection">Yes</span>. When turned on, words <span class="guilabel">Assertion</span> or
<span class="guilabel">Predicate</span> in the Analyzer log, for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">check</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">run</span></code>
commands respectively, will open a pop-window with this information. Below is
how it looks for the command above.</p>
<a class="reference internal image-reference" href="../../../../_images/log12.png"><img alt="../../../../_images/log12.png" class="align-center" src="../../../../_images/log12.png" style="width: 550px;" /></a>
<p>You can inspect the full formula that was extracted from an Alloy model after
all the structure was flattened (it will probably be a bit more verbose than the
simplified snippets shown above). You’ll also find the corresponding Java code
that allows the generation of that problem, since Kodkod does not support a
concrete syntax for defining problems.</p>
</section>
<section id="model-finding-under-the-hood">
<h2>Model finding under the hood<a class="headerlink" href="#model-finding-under-the-hood" title="Link to this heading">#</a></h2>
<p id="index-2">Kodkod relies on off-the-shelf SAT solvers to solve model finding problems. SAT
solvers process only propositional formulas in conjunctive normal form (CNF),
and generating these from models as rich as Kodkod is not trivial <a class="reference internal" href="../../../../bibliography.html#fse04" id="id2"><span>[FSE04]</span></a>.
Roughly, if the universe has <em>u</em> atoms, each <em>n</em>-ary relation is seen as an
<em>n</em>-dimensional Boolean matrix with size <em>u</em>, where each entry in the matrix
denotes whether an <em>n</em>-ary tuple belongs to the relation. Using the bounds
declared for the relation, some of these entries will be necessarily true, and
some necessarily false; for those in between, Boolean variables are created
whose value will be determined by the solver. Then, relational operations are
converted into corresponding matrix operators. For instance, the union
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">+</span></code> is encoded as entrywise matrix disjunction, while composition
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">.</span></code> is encoded as matrix multiplication. Atomic formulas are converted
accordingly. For instance, inclusion <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="ow">in</span></code> is encoded as the conjunction
of entrywise implications. Finally, first-order operators are translated into
propositional logic, which is possible because at this point the finite universe
of atoms is known. So universal quantifications <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">all</span></code> are flattened into
conjunctions and existential <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">some</span></code> into disjunctions.</p>
<p>Let us get back to our example. It has 6 atoms, so unary relations are
represented by 6 x 1 matrices (a vector). Below are the matrices corresponding
to the unary relations. Notice how tuples that necessarily belong to a relation
due to its lower-bound are set to true (here only <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span></code>), and those
outside the upper-bound are set to false. Those between the lower- and
upper-bound are assigned a new Boolean variable.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span></code></p></td>
<td></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir$</span></code></p></td>
<td></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File</span></code></p></td>
<td></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code></p></td>
<td></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\top\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_1\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_2\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_3\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_4\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_5\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_6\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Getting back to command <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">all_files_root</span></code>, relation <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span> <span class="o">+</span> <span class="n">Dir$</span></code>
(i.e., relation <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span></code>) is calculated by the entrywise disjunction of the
corresponding matrices, resulting in the matrix below.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span> <span class="o">+</span> <span class="n">Dir$</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\top\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_1\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>The binary relations are represented by 6 x 6 matrices. Below is the matrix for
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">object</span></code> (matrices for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">entries</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">name</span></code> are omitted but
look similar).</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">object</span></code></p></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_{7}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(v_{8}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(v_{9}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(v_{10}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Continuing with command <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">all_files_root</span></code>, we must calculate composition
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span><span class="o">.</span><span class="n">object</span></code>, which is encoded as matrix multiplication. The result is
the following vector. Intuitively, this states that, for instance, atom
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code> is present in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span><span class="o">.</span><span class="n">object</span></code> if <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code> exists in
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> (<span class="math notranslate nohighlight">\(v_3\)</span>) and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">object</span></code> relates those two atoms
(<span class="math notranslate nohighlight">\(v_9\)</span>), or <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code> exists in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> (<span class="math notranslate nohighlight">\(v_4\)</span>) and is
related with <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code> through <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">object</span></code> (<span class="math notranslate nohighlight">\(v_{10}\)</span>).</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span><span class="o">.</span><span class="n">object</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\((v_3 \wedge v_7) \vee (v_4 \wedge v_8)\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\((v_3 \wedge v_9) \vee (v_4 \wedge v_{10})\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-even"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name0</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code></p></td>
<td><p><span class="math notranslate nohighlight">\(\bot\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Now, it only remains to encode the inclusion <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span><span class="o">.</span><span class="n">object</span> <span class="ow">in</span> <span class="n">Dir</span></code>
through entrywise implication of the two corresponding matrices. The result is
the following propositional formula.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}&amp;(((v_3 \wedge v_7) \vee (v_4 \wedge v_8)) \rightarrow \top) \wedge (((v_3 \wedge v_9) \vee (v_4 \wedge v_{10})) \rightarrow v_1) \\
&amp;\equiv \\
&amp;((v_3 \wedge v_9) \vee (v_4 \wedge v_{10})) \rightarrow v_1\end{split}\]</div>
</div>
<p>This reads as: if atom <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object0</span></code> belongs to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span><span class="o">.</span><span class="n">object</span></code>, then
it must belong to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir$</span></code> (<span class="math notranslate nohighlight">\(v_1\)</span>). The first conjunct was trivially
true since it related to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root0</span></code>, which is necessarily in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span></code>
through <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span></code>. Although we avoided it for simplicity, in practice, the
resulting formula will be in CNF.</p>
<p>When the Analyzer reports the result of a command, you can actually get a bit of
an insight of the complexity of the SAT problem deployed underneath. The
<em>primary vars</em> reported are precisely those that correspond to tuples of the
problem’s relations. The execution of command <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">all_files_root</span></code> shown
above reported 18 primary variables (the 10 shown above plus another 8 for the
omitted <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">entries</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">name</span></code> relations). The <em>vars</em> and <em>clauses</em>
result from the translation of the problem’s formula into CNF.</p>
<p>Since the process relies on SAT problems, it can deploy different solvers, and
the Analyzer comes packaged with many state-of-the-art solves. The SAT solver
used by Kodkod can be set through the menu option <span class="menuselection">Options ‣
Solver</span> of the Analyzer. By default, this solver is set to
<span class="menuselection">SAT4J</span>, a Java SAT solver that is guaranteed to run in every
operating system that the Analyzer also runs. While it’s impossible to predict
which SAT solver will perform best for each particular model, SAT4J is rarely
the fastest, and the user can explore other solvers that come pre-packaged with
the Analyzer depending on the operating system, such as <span class="menuselection">Glucose</span>
or <span class="menuselection">MiniSAT</span>. Note that instance iteration requires the usage of
an incremental SAT solver to be feasible. So if you select a SAT solver that is
not incremental (such as <span class="menuselection">Lingeling</span>), you’ll get an error
message when trying to iterate instances in the visualizer. Note also that the
order on which the instances are generated my change depending on the selected
solver (although eventually they will all generate the same set of instances).</p>
</section>
<section id="skolemization">
<h2>Skolemization<a class="headerlink" href="#skolemization" title="Link to this heading">#</a></h2>
<p>Before deploying the solver, Kodkod performs a process called <em>Skolemization</em>
whenever outermost existential quantifications occur in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">run</span></code> commands
(or universal quantifications for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">check</span></code> commands), which solves those
variables by creating additional free sets to represent them. This largely
improves the efficiency of the analysis procedures, and as a side-effect such
singleton sets are now also part of the generated instance. Moreover,
Skolemization allows the analysis of some commands with <em>higher-order
quantifications</em>, which is forbidden in Alloy in general: a Skolemized
higher-order variable will just give rise to a new relation with the appropriate
arity. Such Skolemized variables can be treated as any other subset in the theme
customization. You can control how deep the Analyzer will search for
quantifications to Skolemize through menu option <span class="menuselection">Options ‣
Skolem depth</span>, but you cannot actually turn it off altogether.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>&#64;nuno: is this really what the devs had in mind, that Skolemization cannot be turned off??</p>
</div>
<p>Let us consider an example, for our file system model. For instance, the following
command asks for instances where some entry points to a directory.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">run</span> <span class="n">some_entries_dir</span> <span class="o">{</span>
  <span class="k">some</span> <span class="n">d</span><span class="p">:</span> <span class="n">Dir</span> <span class="o">|</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">Entry</span><span class="o">.</span><span class="n">object</span>
<span class="o">}</span> <span class="k">for</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The resulting instance is the following, where variable <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code> was
Skolemized and is treated as a regular subset of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span></code>. Its name is
prefixed with the command name, and with a <code class="code docutils literal notranslate"><span class="pre">$</span></code> to distinguish it from the
model’s relations. So it appears in the visualization, can be customized in the
theme, or called in the evaluator. Here, we just set its border to be
<span class="guilabel">Bold</span>. If you look at the log, you’ll notice that the Analyzer now
reported 20 primary variables rather than the expected 18: that’s because
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code> was encoded as a relation of the Kodkod problem.</p>
<a class="reference internal image-reference" href="../../../../_images/viz1.png"><img alt="../../../../_images/viz1.png" class="align-center" src="../../../../_images/viz1.png" style="width: 450px;" /></a>
<p>Higher-order quantifications are not commonly used, but let us try see an
example where they could be used. Let’s say we want to see an instance where
there exists a path between two entries with the same name and identify that
path. One possible way to do this is to use a higher-order quantification
to force the existence of this path, such as shown below.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">pred</span> <span class="nf">total_order</span> <span class="o">[</span><span class="n">s</span><span class="p">:</span><span class="k">set</span> <span class="kc">univ</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span><span class="n">l</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">some</span> <span class="n">s</span>
  <span class="n">r</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">lone</span> <span class="o">-&gt;</span> <span class="k">lone</span> <span class="n">s</span>
  <span class="k">all</span> <span class="n">x</span><span class="p">:</span> <span class="n">s</span> <span class="o">|</span> <span class="n">x</span> <span class="o">=</span> <span class="n">l</span> <span class="ow">implies</span> <span class="k">no</span> <span class="n">x</span><span class="o">.</span><span class="n">r</span> <span class="k">else</span> <span class="k">one</span> <span class="n">x</span><span class="o">.</span><span class="n">r</span>
  <span class="n">s</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.*</span><span class="n">r</span>
<span class="o">}</span>

<span class="k">run</span> <span class="n">path_same_name</span> <span class="o">{</span>
  <span class="k">some</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">:</span> <span class="n">Entry</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">object</span><span class="o">.</span><span class="n">entries</span> <span class="o">{</span>
    <span class="n">f1</span> <span class="o">!=</span> <span class="n">f2</span> <span class="ow">and</span> <span class="n">f2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">name</span>
    <span class="n">total_order</span><span class="o">[</span><span class="n">f1</span><span class="o">.*(</span><span class="n">object</span><span class="o">.</span><span class="n">entries</span><span class="o">)</span> <span class="o">&amp;</span> <span class="o">*(</span><span class="n">object</span><span class="o">.</span><span class="n">entries</span><span class="o">).</span><span class="n">f2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">r</span><span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="k">for</span> <span class="mi">4</span> <span class="k">but</span> <span class="mi">2</span> <span class="n">Name</span>
</pre></div>
</div>
<p>After Skolemization such a relation will be part of the instance, as can be seen
in the example below.</p>
<a class="reference internal image-reference" href="../../../../_images/viz2.png"><img alt="../../../../_images/viz2.png" class="align-center" src="../../../../_images/viz2.png" style="width: 450px;" /></a>
<p>It’s worth noting that this did not add any expressiveness to the language: you
could achieve the same result by introducing a new field in signature
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> and enforcing the same constraints over it (although this would
pollute the model, while the higher-order quantification is local to the fact).
And again, these higher-order quantification are only supported if they can be
Skolemized, otherwise an error is thrown by the Analyzer.</p>
<div class="sd-sphinx-override sd-cards-carousel sd-card-cols-2 docutils">
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-link" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg> Further reading</p>
</div>
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Commands in detail</div>
<p class="sd-card-text">Analysis is triggered by commands declared in the model. Learn in detail how these are defined.</p>
</div>
<a class="sd-stretched-link reference internal" href="../testing-instances/index.html#testing-instances"><span class="std std-ref"></span></a></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../../behavioral-modeling/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Behavioral modeling</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../type-system/index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Type system</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2024, Alcino Cunha, Nuno Macedo, Julien Brunel, David Chemouil
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Structural analysis</a><ul>
<li><a class="reference internal" href="#relational-model-finding">Relational model finding</a></li>
<li><a class="reference internal" href="#model-finding-under-the-hood">Model finding under the hood</a></li>
<li><a class="reference internal" href="#skolemization">Skolemization</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>