<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="Enumeration signatures" href="../enumerations/index.html" /><link rel="prev" title="Subset signatures" href="../subset-signatures/index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Higher-arity relations - Practical Alloy</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2a5adf;
  --color-brand-content: #2a5adf;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Practical Alloy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">Practical Alloy</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about-alloy/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about-book/index.html">About this book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../writer-notes.html">Writer notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../structural-modeling/index.html">Structural modeling</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Structural quick reads</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Structural quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../subset-signatures/index.html">Subset signatures</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Higher-arity relations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enumerations/index.html">Enumeration signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Commands in detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes/index.html">Visualization customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluator/index.html">The instance evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-instances/index.html">Encoding test instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relational-logic/index.html">A relational logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bestiary/index.html">Arrow multiplicity checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ordering/index.html">The predefined <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">ordering</span></code> module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/index.html">Module system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../recursion/index.html">Handling recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integers/index.html">Working with integers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../type-system/index.html">Type system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analysis/index.html">Structural analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../behavioral-modeling/index.html">Behavioral modeling</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../behavioral-topics/index.html">Behavioral quick reads</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Behavioral quick reads</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/mutable-toplevel-signatures/index.html">Mutable top-level signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/event-depiction/index.html">An idiom for event depiction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/scenarios/index.html">Encoding trace scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/evaluator/index.html">The trace evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/temporal-logic/index.html">A temporal logic primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/pointwise-effects/index.html">Pointwise effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/fairness/index.html">Safety, Liveness and Fairness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/sequences/index.html">Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/macros/index.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../behavioral-topics/topics/meta/index.html">Meta-capabilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protocol-design/index.html">Protocol design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../app-design/index.html">App design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interaction-design/index.html">Interaction design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../system-design/index.html">Controller design</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="higher-arity-relations">
<span id="nary-relations"></span><h1>Higher-arity relations<a class="headerlink" href="#higher-arity-relations" title="Link to this heading">#</a></h1>
<p id="index-0">In the main chapter we’ve seen how to introduce unary relations (as signatures)
and binary relations (as fields), and how to compose them in relational
expressions. However, Alloy actually supports relations of arity higher than 2:
they are simply seen as a set of tuples of a certain arity. We call a relation
with arity <em>n &gt; 0</em> an <em>n-ary relation</em>, and it must be uniform (i.e., all tuples in
it must have arity <em>n</em>). Sets and binary relations are 1-ary and 2-ary
relations, respectively. Most of Alloy’s relational operators actually apply to
relations of arbitrary arity (except for a few that only apply to binary
relations). Free <em>n</em>-ary relations are introduced in the model through the
declaration of <em>n</em>-ary fields. This chapter explores relations with arity higher
than 2, which we denote as <em>higher-arity relations</em> to distinguish from sets and
binary relations.</p>
<section id="declaring-n-ary-fields">
<h2>Declaring <em>n</em>-ary fields<a class="headerlink" href="#declaring-n-ary-fields" title="Link to this heading">#</a></h2>
<p>Let us get back to the file system example from the main chapter
<a class="reference internal" href="../../../structural-modeling/index.html#structural-modeling"><span class="std std-ref">Structural modeling</span></a>, where the content of a directory is specified as a
set of entries that assign a name to an object. Using only binary fields, the
solution we implemented used a signature <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> to register exactly one
name and one object; then a field <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">entries</span></code> assigned a set of
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> atoms to each directory. These entries are not really an essential
part of the design of the file system and are not the target of any of the
expected properties, but were required to group names and objects in a single
entity.</p>
<p id="index-1">An alternative to this approach would be to encode the content of a directory as
a set of pairs containing a name and an object, without creating the auxiliary
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> atoms. In practice, this amounts to creating a <em>ternary</em> field
between directories, names, and objects. In Alloy, such a field could be simply
declared as follows:</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="kd">sig</span> <span class="nc">Dir</span> <span class="k">extends</span> <span class="nc">Object</span> <span class="o">{</span>
  <span class="n">contents</span> <span class="p">:</span> <span class="n">Name</span> <span class="o">-&gt;</span> <span class="n">Object</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The type expression of the declaration of <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code> now binary, so each
directory is assigned a binary relation that relates names and objects of that
directory. So relation <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code> is ternary relation that is a subset of
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span> <span class="o">-&gt;</span> <span class="n">Name</span> <span class="o">-&gt;</span> <span class="n">Object</span></code>. Although it may help to interpret a ternary field
as a relation from the source signature to pairs of atoms, in practice the a
ternary relation is simply a set of flatted triples, and can be navigated in
both directions. In theory, we can declare fields of an arbitrary arity in an
Alloy model. In practice, relations with a large arity become impossible to
processed by the Analyzer. This limit depends on the size of the universe of
discourse. For instance, a 5-ary field can only be represented in universes with
less than 74 atoms. However, in our experience, relations with arity higher than
3 are very rarely useful as manipulating them in constraints becomes cumbersome.
It should also be noted that higher-arity relations often contribute to a
reduction of the size of the universe. For instance, in our example, by avoiding
the creation of auxiliary signature <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> we removed all those atoms
from the universe.</p>
</section>
<section id="visualizing-n-ary-relations">
<h2>Visualizing <em>n</em>-ary relations<a class="headerlink" href="#visualizing-n-ary-relations" title="Link to this heading">#</a></h2>
<p id="index-2">Let us for now ignore all additional facts that we had defined for the file
system model (which we will need to adapt to the new ternary field), and just
run the empty <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">example</span></code> command. You may need to remove any scope assigned
to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> since that signature no longer exists. We will get instances
such as the following.</p>
<a class="reference internal image-reference" href="../../../../_images/instance120.png"><img alt="../../../../_images/instance120.png" class="align-center" src="../../../../_images/instance120.png" style="width: 500px;" /></a>
<p>Notice how ternary relations are still represented as edges in the Analyzer’s
visualizer between the first and the last domain of the relation; the middle
domain is shown as a label in the edges. So, that instance, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Root</span></code>
contains  <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">File1</span></code> with name <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name2</span></code> and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span></code> with
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name1</span></code>. For fields of higher arity, additional atoms are added to the
edges’ labels.</p>
</section>
<section id="combining-n-ary-relations">
<h2>Combining <em>n</em>-ary relations<a class="headerlink" href="#combining-n-ary-relations" title="Link to this heading">#</a></h2>
<p id="index-3">The instance above exhibits many of the issues that we addressed in the main
chapter. Let us adapt the facts to the new version of the model that relies on a
ternary field. Most relational operators work for higher-arity relations as they
do for binary ones. Set operators such as intersection (<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">&amp;</span></code>), union
(<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">+</span></code>), and difference (<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">-</span></code>) can be applied between two relations of
the same arbitrary arity. Composition also applies to higher arity relations. If
you have a directory <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code>, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span><span class="o">.</span><span class="n">contents</span></code> is a binary relation within
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name</span> <span class="o">-&gt;</span> <span class="n">Object</span></code> containing all pairs of names and objects assigned to
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code> by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code>. Likewise, for an object <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">o</span></code>,
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span><span class="o">.</span><span class="n">o</span></code> is a binary relation pairing directories with the names that
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">o</span></code> has inside them.</p>
<p>The first fact in the model, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">unique_names</span></code>, forced different entries of a
directory to have distinct names. The original version of this fact calculated
all entries of each directory with a given name, and forced the resulting set to
have at most one value. In the new version, we can follow a similar strategy, as
follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fact</span> <span class="nf">unique_names</span> <span class="o">{</span>
  <span class="c1">// Different entries in the same directory must have different names</span>
  <span class="k">all</span> <span class="n">d</span> <span class="p">:</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span> <span class="n">Name</span> <span class="o">|</span> <span class="k">lone</span> <span class="n">n</span><span class="o">.(</span><span class="n">d</span><span class="o">.</span><span class="n">contents</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span><span class="o">.</span><span class="n">contents</span></code> is a binary relation containing alls pair of names and
objects assigned to <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code>, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">n</span><span class="o">.(</span><span class="n">d</span><span class="o">.</span><span class="n">contents</span><span class="o">)</span></code> is a unary relation with
the objects assigned name <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">n</span></code> in directory <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code>. Since we want at
most one object with each name in a directory, we restrict this set to have
cardinality <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">lone</span></code>. Parenthesis are needed here because composition
associates to the left and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">n</span><span class="o">.</span><span class="n">d</span></code> is not a valid expression (it would have
arity 0).</p>
<p id="index-4">Interestingly, once we encode the content of a directory as a ternary relation,
we can actually enforce this constraint directly when declaring the field.
Higher-arity fields can also be restricted by multiplicity constraints in their
declaration. In this case, we want to enforce that for any directory, and for
any name, there is at most one object related by <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code>. This could be
enforced as follows, as an alternative to fact <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">unique_names</span></code>.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="kd">sig</span> <span class="nc">Dir</span> <span class="k">extends</span> <span class="nc">Object</span> <span class="o">{</span>
  <span class="n">contents</span> <span class="p">:</span> <span class="n">Name</span> <span class="o">-&gt;</span> <span class="k">lone</span> <span class="n">Object</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The second fact, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">no_shared_dirs</span></code>, forced every directory to appear at
most in one entry. This one can be trivially adapted to the ternary field as
follows. Relation <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span><span class="o">.</span><span class="n">d</span></code> contains relates directories with the names
that <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code> has inside them. A directory can only be contained in a single
directory regardless of the name, so this expression is restricted by
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">lone</span></code>.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fact</span> <span class="nf">no_shared_dirs</span> <span class="o">{</span>
  <span class="c1">// A directory cannot be contained in more than one entry</span>
  <span class="k">all</span> <span class="n">d</span> <span class="p">:</span> <span class="n">Dir</span> <span class="o">|</span> <span class="k">lone</span> <span class="n">contents</span><span class="o">.</span><span class="n">d</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Fact <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">no_dangling_objects</span></code> forced all objects, except the root, to be
contained in some entry. In the previous version, expression
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span><span class="o">.</span><span class="n">object</span></code> denoted every object referred by any entry. In the ternary
version, we must retrieve all objects related to any object by any name, which
is represented by expression <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Name</span><span class="o">.(</span><span class="n">Object</span><span class="o">.</span><span class="n">contents</span><span class="o">)</span></code>. Given this expression,
the fact could be trivially adapted as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fact</span> <span class="nf">no_dangling_objects</span> <span class="o">{</span>
  <span class="c1">// Every object except the root is contained somewhere</span>
  <span class="n">Name</span><span class="o">.(</span><span class="n">Object</span><span class="o">.</span><span class="n">contents</span><span class="o">)</span> <span class="o">=</span> <span class="n">Object</span> <span class="o">-</span> <span class="n">Root</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Fact <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">entry_one_parent</span></code> is no longer needed in this version of the model:
it guaranteed that there were no dangling entry atoms, but this is now
guaranteed by the nature of the ternary field.</p>
</section>
<section id="relations-by-comprehension">
<h2>Relations by comprehension<a class="headerlink" href="#relations-by-comprehension" title="Link to this heading">#</a></h2>
<p>All the facts we’ve adapted thus far were as complex with the ternary field as
they were with auxiliary signature <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Entry</span></code> and binary fields.
Unfortunately, that is not always the case, and the last remaining fact,
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">no_indirect_containment</span></code>, is a bit tricky to encode with the ternary
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code>. That fact, through function <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">descendants</span></code>, relied on
the transitive closure of the binary relation <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">entries</span><span class="o">.</span><span class="n">object</span></code> to collect
all objects indirectly contained in a directory. However, when two ternary
relations are composed, the result is actually a quaternary relation. For
instance, with the ternary <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code>, <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span><span class="o">.</span><span class="n">contents</span></code> is a
quaternary relation contained in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span> <span class="o">-&gt;</span> <span class="n">Name</span> <span class="o">-&gt;</span> <span class="n">Name</span> <span class="o">-&gt;</span> <span class="n">Object</span></code>. So the
transitive closure operations are not well-defined for non-binary relations, and
are forbidden in Alloy.</p>
<p>By inspecting function <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">descendants</span></code>, it is obvious that the name of the
objects inside a directory is irrelevant to calculate this relation, so what we
need is to convert ternary field <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code> in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span> <span class="o">-&gt;</span> <span class="n">Name</span> <span class="o">-&gt;</span>
<span class="n">Object</span></code> to a binary version in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span> <span class="o">-&gt;</span> <span class="n">Object</span></code> that relates directories
with their content disregarding the name. Unfortunately, there is no
straightforward way to achieve this using only relational operators, and we need
to rely on defining this relation by <em>comprehension</em>.</p>
<p id="index-5">Relations are defined by comprehension by quantifying over a set of variables,
which are then filtered by a formula over those variables. All relational
operations (except closures) can be rewritten as a relation by comprehension.
For instance, expression <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Object</span> <span class="o">-</span> <span class="n">Root</span></code> above could be rewritten as
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">{</span> <span class="n">o</span> <span class="p">:</span> <span class="n">Object</span> <span class="o">|</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Root</span> <span class="o">}</span></code>, and <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">Dir</span> <span class="o">+</span> <span class="n">File</span></code> as <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="o">{</span> <span class="n">o</span> <span class="p">:</span>
<span class="n">Object</span> <span class="o">|</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">Dir</span> <span class="ow">or</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">File</span> <span class="o">}</span></code>.</p>
<p>For our example, we want to take all directories and objects such that they are
related by some name in <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">contents</span></code>. This can be specified as a
binary relation defined by comprehension that “selects all
directories <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code> and objects <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">o</span></code> such that <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">d</span></code> is related to
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">o</span></code> through <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="k">some</span></code> atom”. Let us define a new auxiliary function <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">objects</span></code>
that provides this derived relation.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">objects</span> <span class="p">:</span> <span class="n">Dir</span> <span class="o">-&gt;</span> <span class="n">Object</span> <span class="o">{</span>
  <span class="o">{</span> <span class="n">d</span> <span class="p">:</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">o</span> <span class="p">:</span> <span class="n">Object</span> <span class="o">|</span> <span class="k">some</span> <span class="n">d</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">o</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Equipped with this relation, it is now trivial to adapt function
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">descendants</span></code> (and consequently, fact <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">no_indirect_containment</span></code>)
to the ternary field as follows.</p>
<div class="highlight-electrum notranslate"><div class="highlight"><pre><span></span><span class="k">fun</span> <span class="nf">descendants</span> <span class="o">[</span><span class="n">o</span> <span class="p">:</span> <span class="n">Object</span><span class="o">]</span> <span class="p">:</span> <span class="k">set</span> <span class="n">Object</span> <span class="o">{</span>
  <span class="n">o</span><span class="o">.^</span><span class="n">objects</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If we now run the empty <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">example</span></code> command once again, we will get
instances such as the following, where the issues seem to have been fixed.</p>
<a class="reference internal image-reference" href="../../../../_images/instance29.png"><img alt="../../../../_images/instance29.png" class="align-center" src="../../../../_images/instance29.png" style="width: 500px;" /></a>
<p>You’ll notice that there is now a new element in the visualization, the value of
function <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">objects</span></code> prefixed by a <code class="code docutils literal notranslate"><span class="pre">$</span></code>. Alloy introduces all
functions without parameters in the visualization, and we’ll see in other
chapters how this can improve visualization of instances. For now we can just
hide it as any other relation by choosing <span class="guilabel">Off</span> in the <span class="guilabel">Show
as arcs</span> theme option for <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">objects</span></code>. This will result in the following
cleaner instance.</p>
<a class="reference internal image-reference" href="../../../../_images/instance35.png"><img alt="../../../../_images/instance35.png" class="align-center" src="../../../../_images/instance35.png" style="width: 500px;" /></a>
<p>To make sure that is the case, we should of course check the
<code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">no_partitions</span></code> assertion. Given that <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">no_partitions</span></code> also relied
on function <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">descendants</span></code> (through predicate <code class="code highlight alloy electrum docutils literal highlight-electrum"><span class="n">reachable</span></code>), nothing
needs to be adapted in this assertion at this point. After executing the
command, the Analyzer will report no counter-examples.</p>
<p>As a last note, it’s not always evident when higher-arity relations should be
used in a model. There is a sweet spot where employing a few higher-arity
relations (almost always, ternary relations) improves the readability and
maintainability of our specifications, while also improving the performance of
the Analyzer by reducing the number of signatures and fields in a model (and
thus the number of atoms and free relations to be solved). If abused, models
can become unmanageable and have a negative impact on performance (since expressions
can become considerably more complex).</p>
<div class="sd-sphinx-override sd-cards-carousel sd-card-cols-2 docutils">
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-link" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg> Further reading</p>
</div>
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
A relational logic primer</div>
<p class="sd-card-text">Most relational operators of Alloy are defined for <em>n</em>-ary relations. Learn more about their semantics.</p>
</div>
<a class="sd-stretched-link reference internal" href="../relational-logic/index.html#relational-logic"><span class="std std-ref"></span></a></div>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-link" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg> Further reading</p>
</div>
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Arrow multiplicity checks</div>
<p class="sd-card-text">Alloy has a special syntax to impose multiplicity constraints that can also be applied to <em>n</em>-ary relations.</p>
</div>
<a class="sd-stretched-link reference internal" href="../bestiary/index.html#bestiary"><span class="std std-ref"></span></a></div>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-link" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg> Further reading</p>
</div>
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Visualization customization</div>
<p class="sd-card-text">We’ve seen that parameterless functions are introduced in the visualization. Learn how to explore this feature.</p>
</div>
<a class="sd-stretched-link reference internal" href="../themes/index.html#theme-customization"><span class="std std-ref"></span></a></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../enumerations/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Enumeration signatures</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../subset-signatures/index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Subset signatures</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2024, Alcino Cunha, Nuno Macedo, Julien Brunel, David Chemouil
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Higher-arity relations</a><ul>
<li><a class="reference internal" href="#declaring-n-ary-fields">Declaring <em>n</em>-ary fields</a></li>
<li><a class="reference internal" href="#visualizing-n-ary-relations">Visualizing <em>n</em>-ary relations</a></li>
<li><a class="reference internal" href="#combining-n-ary-relations">Combining <em>n</em>-ary relations</a></li>
<li><a class="reference internal" href="#relations-by-comprehension">Relations by comprehension</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/design-tabs.js?v=36754332"></script>
    </body>
</html>